/*! For license information please see 418.min.js.LICENSE.txt */
"use strict";(self.webpackChunkdivi_custom_modules=self.webpackChunkdivi_custom_modules||[]).push([[418],{20:function(t,e,r){var n=r(594),o=Symbol.for("react.element"),a=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,s=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function l(t,e,r){var n,a={},l=null,u=null;for(n in void 0!==r&&(l=""+r),void 0!==e.key&&(l=""+e.key),void 0!==e.ref&&(u=e.ref),e)i.call(e,n)&&!c.hasOwnProperty(n)&&(a[n]=e[n]);if(t&&t.defaultProps)for(n in e=t.defaultProps)void 0===a[n]&&(a[n]=e[n]);return{$$typeof:o,type:t,key:l,ref:u,props:a,_owner:s.current}}e.jsx=l,e.jsxs=l},418:function(t,e,r){r.r(e);var n=r(594),o=r(848);function a(t){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a(t)}function i(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function a(r,n,o,a){var i=n&&n.prototype instanceof l?n:l,u=Object.create(i.prototype);return s(u,"_invoke",function(r,n,o){var a,i,s,l=0,u=o||[],d=!1,f={p:0,n:0,v:t,a:m,f:m.bind(t,4),d:function(e,r){return a=e,i=0,s=t,f.n=r,c}};function m(r,n){for(i=r,s=n,e=0;!d&&l&&!o&&e<u.length;e++){var o,a=u[e],m=f.p,p=a[2];r>3?(o=p===n)&&(s=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=t):a[0]<=m&&((o=r<2&&m<a[1])?(i=0,f.v=n,f.n=a[1]):m<p&&(o=r<3||a[0]>n||n>p)&&(a[4]=r,a[5]=n,f.n=p,i=0))}if(o||r>1)return c;throw d=!0,n}return function(o,u,p){if(l>1)throw TypeError("Generator is already running");for(d&&1===u&&m(u,p),i=u,s=p;(e=i<2?t:s)||!d;){a||(i?i<3?(i>1&&(f.n=-1),m(i,s)):f.n=s:f.v=s);try{if(l=2,a){if(i||(o="next"),e=a[o]){if(!(e=e.call(a,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,i<2&&(i=0)}else 1===i&&(e=a.return)&&e.call(a),i<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=t}else if((e=(d=f.n<0)?s:r.call(n,f))!==c)break}catch(e){a=t,i=1,s=e}finally{l=1}}return{value:e,done:d}}}(r,o,a),!0),u}var c={};function l(){}function u(){}function d(){}e=Object.getPrototypeOf;var f=[][n]?e(e([][n]())):(s(e={},n,function(){return this}),e),m=d.prototype=l.prototype=Object.create(f);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,s(t,o,"GeneratorFunction")),t.prototype=Object.create(m),t}return u.prototype=d,s(m,"constructor",d),s(d,"constructor",u),u.displayName="GeneratorFunction",s(d,o,"GeneratorFunction"),s(m),s(m,o,"Generator"),s(m,n,function(){return this}),s(m,"toString",function(){return"[object Generator]"}),(i=function(){return{w:a,m:p}})()}function s(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}s=function(t,e,r,n){function a(e,r){s(t,e,function(t){return this._invoke(e,r,t)})}e?o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r:(a("next",0),a("throw",1),a("return",2))},s(t,e,r,n)}function c(t,e,r,n,o,a,i){try{var s=t[a](i),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,o)}function l(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var a=t.apply(e,r);function i(t){c(a,n,o,i,s,"next",t)}function s(t){c(a,n,o,i,s,"throw",t)}i(void 0)})}}function u(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function d(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?u(Object(r),!0).forEach(function(e){g(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function f(t){return function(t){if(Array.isArray(t))return m(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return m(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?m(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function p(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,w(n.key),n)}}function h(t,e,r){return e=y(e),function(t,e){if(e&&("object"==a(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,v()?Reflect.construct(e,r||[],y(t).constructor):e.apply(t,r))}function v(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(v=function(){return!!t})()}function y(t){return y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},y(t)}function b(t,e){return b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},b(t,e)}function g(t,e,r){return(e=w(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function w(t){var e=function(t,e){if("object"!=a(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=a(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==a(e)?e:e+""}var j=function(t){function e(t){var r,n,a;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),g(n=h(this,e,[t]),"startTimer",function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;n.state.timerRunning||(n.setState({timerRunning:!0,currentTimerRow:t,timerSeconds:0}),n.timerInterval=setInterval(function(){n.setState(function(t){return{timerSeconds:t.timerSeconds+1}})},1e3),n.state.config.timerSound&&n.playTimerSound("start"))}),g(n,"stopTimer",function(){if(n.state.timerRunning){clearInterval(n.timerInterval);var t=n.formatTimeToDecimal(n.state.timerSeconds);null!==n.state.currentTimerRow&&n.updateRowField(n.state.currentTimerRow,"hours",t.toString()),n.setState({timerRunning:!1,currentTimerRow:null,timerSeconds:0}),n.state.config.timerSound&&n.playTimerSound("stop")}}),g(n,"resetTimer",function(){n.timerInterval&&clearInterval(n.timerInterval),n.setState({timerRunning:!1,currentTimerRow:null,timerSeconds:0})}),g(n,"playTimerSound",function(t){if("undefined"!=typeof AudioContext||"undefined"!=typeof webkitAudioContext){var e=new(AudioContext||webkitAudioContext),r=e.createOscillator(),n=e.createGain();r.connect(n),n.connect(e.destination),r.frequency.value="start"===t?800:400,r.type="sine",n.gain.setValueAtTime(0,e.currentTime),n.gain.linearRampToValueAtTime(.2,e.currentTime+.01),n.gain.exponentialRampToValueAtTime(.01,e.currentTime+.2),r.start(e.currentTime),r.stop(e.currentTime+.2)}}),g(n,"addRow",function(){if(!(n.state.rows.length>=n.state.config.maxRows)){var t={id:"temp_"+Date.now(),date:(new Date).toISOString().split("T")[0],project:n.state.config.defaultProject,tasks:"",notes:"",hours:"",rate:n.state.config.defaultHourlyRate.toString(),amount:"0.00",modified:!0};n.setState(function(e){return{rows:[].concat(f(e.rows),[t])}},function(){n.calculateTotals(),n.state.config.timerAutoStart&&n.state.config.showTimer&&n.startTimer(n.state.rows.length-1)})}}),g(n,"deleteRow",function(t){n.state.currentTimerRow===t&&n.stopTimer(),n.setState(function(e){return{rows:e.rows.filter(function(e,r){return r!==t}),currentTimerRow:e.currentTimerRow===t?null:e.currentTimerRow>t?e.currentTimerRow-1:e.currentTimerRow}},n.calculateTotals)}),g(n,"clearAllRows",function(){n.resetTimer(),n.setState({rows:[]},function(){n.calculateTotals(),n.addRow()})}),g(n,"updateRowField",function(t,e,r){n.setState(function(o){var a=f(o.rows);if(a[t]=d(d({},a[t]),{},g(g({},e,r),"modified",!0)),"hours"===e||"rate"===e){var i=((parseFloat(a[t].hours)||0)*(parseFloat(a[t].rate)||0)).toFixed(n.state.config.decimalPlaces);a[t].amount=i}return{rows:a}},function(){n.calculateTotals(),n.debouncedSave(t)})}),g(n,"debouncedSave",(a={},function(t){clearTimeout(a[t]),a[t]=setTimeout(function(){var e=n.state.rows[t];e&&e.modified&&n.saveTimesheetEntry(e,t)},2e3)})),g(n,"calculateTotals",function(){var t=n.state.rows.reduce(function(t,e){var r=parseFloat(e.hours)||0,n=parseFloat(e.amount)||0;return{hours:t.hours+r,amount:t.amount+n}},{hours:0,amount:0});n.setState({totalHours:t.hours,totalAmount:t.amount})}),g(n,"formatTimeDisplay",function(t){var e=Math.floor(t/3600),r=Math.floor(t%3600/60),n=t%60;return"".concat(e.toString().padStart(2,"0"),":").concat(r.toString().padStart(2,"0"),":").concat(n.toString().padStart(2,"0"))}),g(n,"formatTimeToDecimal",function(t){return(t/3600).toFixed(n.state.config.decimalPlaces)}),g(n,"saveTimesheetEntry",function(){var t=l(i().m(function t(e){var r,o,a,s,c=arguments;return i().w(function(t){for(;;)switch(t.p=t.n){case 0:if(r=c.length>1&&void 0!==c[1]?c[1]:null,n.state.config.saveData&&n.state.config.isLoggedIn){t.n=1;break}return t.a(2);case 1:return n.setState({loading:!0}),(o=new FormData).append("action","timesheet_save_entry"),o.append("nonce",n.state.config.nonce),e.id&&"temp"!==e.id&&o.append("entry_id",e.id),o.append("entry_date",e.date),o.append("project",e.project),o.append("tasks",e.tasks),o.append("notes",e.notes),o.append("hours",e.hours),o.append("billable_rate",e.rate),t.p=2,t.n=3,fetch(n.state.config.ajaxUrl,{method:"POST",body:o});case 3:return a=t.v,t.n=4,a.json();case 4:(s=t.v).success?null!==r&&s.data.entry_id&&n.setState(function(t){var e=f(t.rows);return e[r]=d(d({},e[r]),{},{id:s.data.entry_id}),{rows:e}}):n.setState({error:"Failed to save entry: "+s.data.message}),t.n=6;break;case 5:t.p=5,t.v,n.setState({error:"Network error while saving entry"});case 6:return t.p=6,n.setState({loading:!1}),t.f(6);case 7:return t.a(2)}},t,null,[[2,5,6,7]])}));return function(e){return t.apply(this,arguments)}}()),g(n,"loadTimesheetData",l(i().m(function t(){var e,r,o,a;return i().w(function(t){for(;;)switch(t.p=t.n){case 0:if(n.state.config.saveData&&n.state.config.isLoggedIn){t.n=1;break}return t.a(2);case 1:return n.setState({loading:!0}),(e=new FormData).append("action","timesheet_load_entries"),e.append("nonce",n.state.config.nonce),t.p=2,t.n=3,fetch(n.state.config.ajaxUrl,{method:"POST",body:e});case 3:return r=t.v,t.n=4,r.json();case 4:(o=t.v).success?(a=o.data.entries.map(function(t){return{id:t.id,date:t.entry_date,project:t.project,tasks:t.tasks,notes:t.notes,hours:t.hours,rate:t.billable_rate,amount:t.billable_amount}}),n.setState({rows:a},function(){n.calculateTotals(),0===a.length&&n.addRow()})):(n.setState({error:"Failed to load entries: "+o.data.message}),n.addRow()),t.n=6;break;case 5:t.p=5,t.v,n.setState({error:"Network error while loading data"}),n.addRow();case 6:return t.p=6,n.setState({loading:!1}),t.f(6);case 7:return t.a(2)}},t,null,[[2,5,6,7]])}))),g(n,"deleteTimesheetEntry",function(){var t=l(i().m(function t(e,r){var o,a,s;return i().w(function(t){for(;;)switch(t.p=t.n){case 0:if(e&&"temp"!==e){t.n=1;break}return n.deleteRow(r),t.a(2);case 1:return n.setState({loading:!0}),(o=new FormData).append("action","timesheet_delete_entry"),o.append("nonce",n.state.config.nonce),o.append("entry_id",e),t.p=2,t.n=3,fetch(n.state.config.ajaxUrl,{method:"POST",body:o});case 3:return a=t.v,t.n=4,a.json();case 4:(s=t.v).success?n.deleteRow(r):n.setState({error:"Failed to delete entry: "+s.data.message}),t.n=6;break;case 5:t.p=5,t.v,n.setState({error:"Network error while deleting entry"});case 6:return t.p=6,n.setState({loading:!1}),t.f(6);case 7:return t.a(2)}},t,null,[[2,5,6,7]])}));return function(e,r){return t.apply(this,arguments)}}()),g(n,"saveAllPendingChanges",function(){n.state.rows.forEach(function(t,e){t.modified&&n.saveTimesheetEntry(t,e)})}),g(n,"renderTaskOptions",function(){return n.state.config.presetTasks.map(function(t){return(0,o.jsx)("option",{value:t,children:t},t)})});var s=null!==(r=n.props.attrs)&&void 0!==r&&r.config?JSON.parse(n.props.attrs.config):{};return n.state={rows:[],timerRunning:!1,timerSeconds:0,currentTimerRow:null,totalHours:0,totalAmount:0,loading:!1,error:null,config:{maxRows:s.maxRows||10,defaultHourlyRate:s.defaultHourlyRate||50,defaultProject:s.defaultProject||"",presetTasks:s.presetTasks||[],currencySymbol:"$",decimalPlaces:s.decimalPlaces||2,timeFormat:s.timeFormat||"decimal",saveData:!1!==s.saveData,autoSaveInterval:s.autoSaveInterval||1e4,timerAutoStart:s.timerAutoStart||!1,timerSound:s.timerSound||!1,showTimer:!1!==s.showTimer,userId:s.userId||0,isLoggedIn:s.isLoggedIn||!1,ajaxUrl:s.ajaxUrl||"",nonce:s.nonce||""}},n.timerInterval=null,n.autoSaveInterval=null,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&b(t,e)}(e,t),r=e,n=[{key:"componentDidMount",value:function(){var t=this;this.state.config.isLoggedIn?(this.loadTimesheetData(),this.state.config.saveData&&this.state.config.autoSaveInterval>0&&(this.autoSaveInterval=setInterval(function(){t.saveAllPendingChanges()},Math.max(this.state.config.autoSaveInterval,5e3)))):this.setState({error:"Please log in to use the timesheet tracker."})}},{key:"componentWillUnmount",value:function(){this.timerInterval&&clearInterval(this.timerInterval),this.autoSaveInterval&&clearInterval(this.autoSaveInterval)}},{key:"render",value:function(){var t,e=this,r=this.state,n=r.config,a=r.loading,i=r.error;return i?(0,o.jsx)("div",{className:"dicm-timesheet-tracker error-state",children:(0,o.jsx)("div",{className:"error-message",children:(0,o.jsx)("p",{children:i})})}):(0,o.jsxs)("div",{className:"dicm-timesheet-tracker",children:[a&&(0,o.jsx)("div",{className:"loading-overlay",children:(0,o.jsx)("div",{className:"loading-spinner",children:"Saving..."})}),(null===(t=this.props.attrs)||void 0===t?void 0:t.table_title)&&(0,o.jsx)("div",{className:"timesheet-title",children:(0,o.jsx)("h3",{children:this.props.attrs.table_title})}),n.showTimer&&(0,o.jsx)("div",{className:"timer-section",children:(0,o.jsxs)("div",{className:"timer-display",children:[(0,o.jsx)("span",{className:"timer-time",children:this.formatTimeDisplay(this.state.timerSeconds)}),(0,o.jsxs)("div",{className:"timer-controls",children:[this.state.timerRunning?(0,o.jsx)("button",{className:"timer-btn stop-btn",onClick:this.stopTimer,children:(0,o.jsx)("span",{className:"btn-text",children:"Stop"})}):(0,o.jsx)("button",{className:"timer-btn start-btn",onClick:function(){return e.startTimer()},children:(0,o.jsx)("span",{className:"btn-text",children:"Start"})}),(0,o.jsx)("button",{className:"timer-btn reset-btn",onClick:this.resetTimer,children:(0,o.jsx)("span",{className:"btn-text",children:"Reset"})})]})]})}),(0,o.jsxs)("div",{className:"timesheet-container",children:[(0,o.jsxs)("div",{className:"timesheet-controls",children:[(0,o.jsx)("button",{className:"add-row-btn",onClick:this.addRow,disabled:this.state.rows.length>=n.maxRows,children:"+ Add Row"}),(0,o.jsx)("button",{className:"clear-all-btn",onClick:this.clearAllRows,children:"Clear All"}),(0,o.jsxs)("div",{className:"total-summary",children:[(0,o.jsxs)("span",{className:"total-hours",children:["Total Hours: ",(0,o.jsx)("strong",{children:this.state.totalHours.toFixed(n.decimalPlaces)})]}),(0,o.jsxs)("span",{className:"total-amount",children:["Total Amount: ",(0,o.jsxs)("strong",{children:["$",this.state.totalAmount.toFixed(n.decimalPlaces)]})]})]})]}),(0,o.jsx)("div",{className:"timesheet-table-wrapper",children:(0,o.jsxs)("table",{className:"timesheet-table",children:[(0,o.jsx)("thead",{className:"timesheet-header",children:(0,o.jsxs)("tr",{children:[(0,o.jsx)("th",{children:"Date"}),(0,o.jsx)("th",{children:"Project"}),(0,o.jsx)("th",{children:"Tasks"}),(0,o.jsx)("th",{children:"Notes"}),(0,o.jsx)("th",{children:"Hours"}),(0,o.jsx)("th",{children:"Billable Rate"}),(0,o.jsx)("th",{children:"Billable Amount"}),(0,o.jsx)("th",{children:"Actions"})]})}),(0,o.jsx)("tbody",{className:"timesheet-body",children:this.state.rows.map(function(t,r){return(0,o.jsxs)("tr",{className:"timesheet-row",children:[(0,o.jsx)("td",{children:(0,o.jsx)("input",{type:"date",value:t.date,onChange:function(t){return e.updateRowField(r,"date",t.target.value)}})}),(0,o.jsx)("td",{children:(0,o.jsx)("input",{type:"text",value:t.project,placeholder:"Project name",onChange:function(t){return e.updateRowField(r,"project",t.target.value)}})}),(0,o.jsx)("td",{children:n.presetTasks.length>0?(0,o.jsxs)("select",{value:t.tasks,onChange:function(t){return e.updateRowField(r,"tasks",t.target.value)},children:[(0,o.jsx)("option",{value:"",children:"Select task..."}),e.renderTaskOptions()]}):(0,o.jsx)("input",{type:"text",value:t.tasks,placeholder:"Task description",onChange:function(t){return e.updateRowField(r,"tasks",t.target.value)}})}),(0,o.jsx)("td",{children:(0,o.jsx)("textarea",{value:t.notes,placeholder:"Notes",rows:"1",onChange:function(t){return e.updateRowField(r,"notes",t.target.value)}})}),(0,o.jsx)("td",{children:(0,o.jsx)("input",{type:"number",step:"0.01",min:"0",value:t.hours,placeholder:"0.00",onChange:function(t){return e.updateRowField(r,"hours",t.target.value)}})}),(0,o.jsx)("td",{children:(0,o.jsx)("input",{type:"number",step:"0.01",min:"0",value:t.rate,placeholder:n.defaultHourlyRate,onChange:function(t){return e.updateRowField(r,"rate",t.target.value)}})}),(0,o.jsxs)("td",{className:"amount-cell",children:["$",t.amount]}),(0,o.jsxs)("td",{className:"actions-cell",children:[n.showTimer&&(0,o.jsx)("button",{className:"timer-row-btn ".concat(e.state.currentTimerRow===r?"active":""),onClick:function(){return e.state.currentTimerRow===r?e.stopTimer():e.startTimer(r)},disabled:e.state.timerRunning&&e.state.currentTimerRow!==r,title:e.state.currentTimerRow===r?"Stop Timer":"Start Timer",children:e.state.currentTimerRow===r?"⏹":"▶"}),(0,o.jsx)("button",{className:"delete-row-btn",onClick:function(){return e.deleteTimesheetEntry(t.id,r)},title:"Delete Row",disabled:a,children:"🗑"})]})]},t.id)})})]})})]})]})}}],n&&p(r.prototype,n),a&&p(r,a),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n,a}(n.Component);e.default=j},848:function(t,e,r){t.exports=r(20)}}]);